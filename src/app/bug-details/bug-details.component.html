<mat-card class="result" *ngIf="(bug$ | async) as bug; else loading">
  <mat-card-header class="bug-detail-header">
    <mat-card-title style="word-break: break-word;">
      {{bug.id}}&nbsp;{{bug.summary}}
    </mat-card-title>
    <mat-card-subtitle>
      <span [ngStyle]="{'color': severities[bug.severity]?.color}">
        {{bug.severity}}
      </span>
      &nbsp;{{bug.priority}}
    </mat-card-subtitle>
    <mat-card-subtitle>{{bug.buguetteStatus}}</mat-card-subtitle>
  </mat-card-header>
  <mat-card-content class="addition-data">
    <mat-divider></mat-divider>
    <div class="addition-params-space">
      <div class="addition-params">
        <div class="addition-params-icon" matTooltip={{bug.product}}>
          <mat-icon aria-hidden="false" aria-label="Example home icon">location_on</mat-icon>
        </div>
        <div class="addition-params-data">
          <div class="params-data"><span
              [ngStyle]="{'background-color': products[bug.product].color}">{{products[bug.product].name}}</span></div>
          <div class="params-data">{{bug.component}}</div>
          <div class="params-data">{{bug.version}}</div>
        </div>
      </div>
      <div class="addition-params">
        <div class="addition-params-icon" matTooltip="QA contact {{bug.qa_contact}}">
          <mat-icon aria-hidden="false">
            people_alt</mat-icon>
        </div>
        <div class="addition-params-data">
          <div class="params-data">
            Creator: {{bug.creator_detail.real_name || "loading..."}}
          </div>
          <div class="params-data">
            Assigned to:
            {{bug.assigned_to_detail?bug.assigned_to_detail?.real_name:bug.assigned_to}}
          </div>
        </div>
      </div>
      <div class="addition-params">
        <div class="addition-params-icon"
         matTooltip="Created: {{bug.creation_time.getTime() | date : 'd MMMM y, HH:mm'}}&#13;Updated: {{bug.last_change_time.getTime() | date : 'd MMMM y, HH:mm'}}">
          <mat-icon aria-hidden="false" aria-label="Example home icon"  matTooltipClass="multiline-tooltip">
            date_range
          </mat-icon>
        </div>
        <div class="addition-params-data">
          <div class="params-data">
            {{bug.creation_time.getTime() | date : 'd MMMM y'}}
          </div>
          <div class="params-data" *ngIf="bug.last_change_time.getTime() !== bug.creation_time.getTime()">
            {{bug.last_change_time.getTime() | date : 'd MMMM y'}}
          </div>
        </div>
      </div>
      <div class="space"></div>
      <div class="addition-params addition-params-bugzilla-link" matRipple matTooltip="[NEW TAB] {{bugzillaLink}}">
        <a [href]="bugzillaLink" target="_blank" style="height: 100%;">
          <div class="bugzilla-image">
          </div>
        </a>
      </div>
    </div>
    <mat-divider></mat-divider>
    <div class="comment main-comment">
      <span class="comment-text" *ngIf="image_autoload && bug.comments[0]?.attachment_is_image">
        {{bug.comments[0]?.text}}
      </span>
      <app-detail-attachment
      [id]="bug.comments[0]?.attachment_id"
      [imageAutoload]="image_autoload"
      [bugData]="bug.comments[0]"></app-detail-attachment>
      <span class="comment-text" *ngIf="!image_autoload || !bug.comments[0]?.attachment_is_image">
        {{bug.comments[0]?.text}}
      </span>
    </div>
  </mat-card-content>
</mat-card>

<mat-card *ngFor="let comment of (bug$ | async)?.comments | slice:1" class="result comment mat-elevation-z2">
  <div class="left-block-comment">
    <ng-container *ngIf="(users$ | async) as users">
    <div class="creator-image" *ngIf="users[comment.creator_username] as user">
      <img class="avatar-image" matTooltip={{user.real_name}} [src]="user.avatar || '/assets/avatars/default.jpg'">
    </div>
    <span *ngIf="!users[comment.creator_username]" matTooltip="User not found">{{comment.creator_username}}</span>
    </ng-container>
  </div>
  <div class="right-block-comment">
    <div class="comment-date">
      {{comment.creation_time.getTime() | date : 'd MMMM y, HH:mm'}}
    </div>
    <app-detail-attachment
    [id]="comment.attachment_id"
    [imageAutoload]="image_autoload"
    [bugData]="comment"></app-detail-attachment>
    <div class="comment-text" *ngIf="comment.text">
      <app-detail-comment-text [text]="comment.text"></app-detail-comment-text>
    </div>
  </div>
</mat-card>


<ng-template #loading>
  <mat-spinner style="margin: auto;"></mat-spinner>
</ng-template>
